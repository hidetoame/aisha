#!/usr/bin/env python
import os
import django
import sys

# Djangoプロジェクトのパスを追加
sys.path.append('/app')

# Django設定
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')
django.setup()

from api.services.suzuri_api_service import SuzuriAPIService

def test_car_merchandise_creation():
    """車の画像からSUZURIグッズ作成のテスト"""
    print("🚗 SUZURI 車グッズ作成テスト開始")
    print("=" * 60)
    
    # テスト用車画像URL（公開アクセス可能なサンプル画像）
    test_image_url = "https://images.unsplash.com/photo-1583121274602-3e2820c69888?w=800"
    test_car_name = "NISSAN FAIRLADY Z"
    test_description = "AISHA で生成されたテスト車両のTシャツです。"
    
    print(f"📸 テスト画像URL: {test_image_url}")
    print(f"🚗 車名: {test_car_name}")
    print(f"📝 説明: {test_description}")
    print()
    
    try:
        # APIサービスを初期化
        suzuri_service = SuzuriAPIService()
        print("✅ SUZURI API サービス初期化完了")
        
        # グッズ作成を実行
        print("🛠️ グッズ作成開始...")
        result = suzuri_service.create_car_merchandise(
            image_url=test_image_url,
            car_name=test_car_name,
            description=test_description
        )
        
        print("📋 作成結果:")
        print(f"  成功: {result.get('success')}")
        
        if result['success']:
            print("🎉 グッズ作成成功！")
            print()
            print("📦 作成された商品情報:")
            product = result.get('product', {})
            print(f"  商品ID: {product.get('id', 'N/A')}")
            print(f"  商品タイトル: {product.get('title', 'N/A')}")
            print(f"  商品URL: {result.get('product_url', 'N/A')}")
            print(f"  サンプル画像URL: {product.get('sampleImageUrl', 'N/A')}")
            
            print()
            print("🎯 アイテム情報:")
            item = result.get('item', {})
            print(f"  アイテム名: {item.get('name', 'N/A')}")
            print(f"  アイテムID: {item.get('id', 'N/A')}")
            
            print()
            print("🖼️ マテリアル情報:")
            material = result.get('material', {})
            print(f"  マテリアルID: {material.get('id', 'N/A')}")
            print(f"  マテリアルタイトル: {material.get('title', 'N/A')}")
            
        else:
            print("❌ グッズ作成失敗")
            print(f"  エラー: {result.get('error', '不明なエラー')}")
            
    except Exception as e:
        print(f"💥 テスト中にエラーが発生: {str(e)}")
        import traceback
        print(f"📋 詳細: {traceback.format_exc()}")

if __name__ == "__main__":
    test_car_merchandise_creation()
    print("=" * 60)
    print("🏁 テスト完了")
