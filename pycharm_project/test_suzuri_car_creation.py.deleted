#!/usr/bin/env python
import os
import django
import sys

# Djangoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹ã‚’è¿½åŠ 
sys.path.append('/app')

# Djangoè¨­å®š
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')
django.setup()

from api.services.suzuri_api_service import SuzuriAPIService

def test_car_merchandise_creation():
    """è»Šã®ç”»åƒã‹ã‚‰SUZURIã‚°ãƒƒã‚ºä½œæˆã®ãƒ†ã‚¹ãƒˆ"""
    print("ğŸš— SUZURI è»Šã‚°ãƒƒã‚ºä½œæˆãƒ†ã‚¹ãƒˆé–‹å§‹")
    print("=" * 60)
    
    # ãƒ†ã‚¹ãƒˆç”¨è»Šç”»åƒURLï¼ˆå…¬é–‹ã‚¢ã‚¯ã‚»ã‚¹å¯èƒ½ãªã‚µãƒ³ãƒ—ãƒ«ç”»åƒï¼‰
    test_image_url = "https://images.unsplash.com/photo-1583121274602-3e2820c69888?w=800"
    test_car_name = "NISSAN FAIRLADY Z"
    test_description = "AISHA ã§ç”Ÿæˆã•ã‚ŒãŸãƒ†ã‚¹ãƒˆè»Šä¸¡ã®Tã‚·ãƒ£ãƒ„ã§ã™ã€‚"
    
    print(f"ğŸ“¸ ãƒ†ã‚¹ãƒˆç”»åƒURL: {test_image_url}")
    print(f"ğŸš— è»Šå: {test_car_name}")
    print(f"ğŸ“ èª¬æ˜: {test_description}")
    print()
    
    try:
        # APIã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–
        suzuri_service = SuzuriAPIService()
        print("âœ… SUZURI API ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–å®Œäº†")
        
        # ã‚°ãƒƒã‚ºä½œæˆã‚’å®Ÿè¡Œ
        print("ğŸ› ï¸ ã‚°ãƒƒã‚ºä½œæˆé–‹å§‹...")
        result = suzuri_service.create_car_merchandise(
            image_url=test_image_url,
            car_name=test_car_name,
            description=test_description
        )
        
        print("ğŸ“‹ ä½œæˆçµæœ:")
        print(f"  æˆåŠŸ: {result.get('success')}")
        
        if result['success']:
            print("ğŸ‰ ã‚°ãƒƒã‚ºä½œæˆæˆåŠŸï¼")
            print()
            print("ğŸ“¦ ä½œæˆã•ã‚ŒãŸå•†å“æƒ…å ±:")
            product = result.get('product', {})
            print(f"  å•†å“ID: {product.get('id', 'N/A')}")
            print(f"  å•†å“ã‚¿ã‚¤ãƒˆãƒ«: {product.get('title', 'N/A')}")
            print(f"  å•†å“URL: {result.get('product_url', 'N/A')}")
            print(f"  ã‚µãƒ³ãƒ—ãƒ«ç”»åƒURL: {product.get('sampleImageUrl', 'N/A')}")
            
            print()
            print("ğŸ¯ ã‚¢ã‚¤ãƒ†ãƒ æƒ…å ±:")
            item = result.get('item', {})
            print(f"  ã‚¢ã‚¤ãƒ†ãƒ å: {item.get('name', 'N/A')}")
            print(f"  ã‚¢ã‚¤ãƒ†ãƒ ID: {item.get('id', 'N/A')}")
            
            print()
            print("ğŸ–¼ï¸ ãƒãƒ†ãƒªã‚¢ãƒ«æƒ…å ±:")
            material = result.get('material', {})
            print(f"  ãƒãƒ†ãƒªã‚¢ãƒ«ID: {material.get('id', 'N/A')}")
            print(f"  ãƒãƒ†ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒˆãƒ«: {material.get('title', 'N/A')}")
            
        else:
            print("âŒ ã‚°ãƒƒã‚ºä½œæˆå¤±æ•—")
            print(f"  ã‚¨ãƒ©ãƒ¼: {result.get('error', 'ä¸æ˜ãªã‚¨ãƒ©ãƒ¼')}")
            
    except Exception as e:
        print(f"ğŸ’¥ ãƒ†ã‚¹ãƒˆä¸­ã«ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ: {str(e)}")
        import traceback
        print(f"ğŸ“‹ è©³ç´°: {traceback.format_exc()}")

if __name__ == "__main__":
    test_car_merchandise_creation()
    print("=" * 60)
    print("ğŸ ãƒ†ã‚¹ãƒˆå®Œäº†")
