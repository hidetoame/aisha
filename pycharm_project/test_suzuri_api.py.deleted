#!/usr/bin/env python
import os
import django
import sys

# Djangoãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ‘ã‚¹ã‚’è¿½åŠ 
sys.path.append('/app')

# Djangoè¨­å®š
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'django_project.settings')
django.setup()

from api.services.suzuri_api_service import SuzuriAPIService

def test_suzuri_api():
    """SUZURI API ã®å‹•ä½œãƒ†ã‚¹ãƒˆ"""
    print("ğŸ§ª SUZURI API å‹•ä½œãƒ†ã‚¹ãƒˆé–‹å§‹")
    print("=" * 50)
    
    # APIã‚µãƒ¼ãƒ“ã‚¹ã‚’åˆæœŸåŒ–
    try:
        suzuri_service = SuzuriAPIService()
        print("âœ… SUZURI API ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–å®Œäº†")
        
        # APIãƒˆãƒ¼ã‚¯ãƒ³ã®ç¢ºèª
        if not suzuri_service.api_token or suzuri_service.api_token == 'your_actual_suzuri_api_token_here':
            print("âŒ SUZURI_API_TOKEN ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“")
            return False
        
        print(f"ğŸ”‘ API Token: {suzuri_service.api_token[:10]}...{suzuri_service.api_token[-5:]}")
        
    except Exception as e:
        print(f"âŒ SUZURI API ã‚µãƒ¼ãƒ“ã‚¹åˆæœŸåŒ–ã‚¨ãƒ©ãƒ¼: {str(e)}")
        return False
    
    # ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ã®å–å¾—ãƒ†ã‚¹ãƒˆ
    print("\nğŸ“¦ åˆ©ç”¨å¯èƒ½ãªã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ã‚’å–å¾—ä¸­...")
    try:
        items = suzuri_service.get_items()
        
        if items is None:
            print("âŒ ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ã®å–å¾—ã«å¤±æ•—ã—ã¾ã—ãŸ")
            return False
        
        if len(items) == 0:
            print("âš ï¸ ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§ãŒç©ºã§ã™")
            return False
            
        print(f"âœ… {len(items)}å€‹ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’å–å¾—ã—ã¾ã—ãŸ")
        
        # æœ€åˆã®5ã¤ã®ã‚¢ã‚¤ãƒ†ãƒ ã‚’è¡¨ç¤º
        print("\nğŸ“‹ å–å¾—ã—ãŸã‚¢ã‚¤ãƒ†ãƒ ï¼ˆæœ€åˆã®5ã¤ï¼‰:")
        for i, item in enumerate(items[:5]):
            print(f"  {i+1}. ID: {item.get('id')}, Name: {item.get('name')}")
        
        # Tã‚·ãƒ£ãƒ„ã‚¢ã‚¤ãƒ†ãƒ ã‚’æ¢ã™
        tshirt_item = None
        for item in items:
            if 'tshirt' in item.get('name', '').lower() or 'ã‚·ãƒ£ãƒ„' in item.get('name', '') or 't-shirt' in item.get('name', '').lower():
                tshirt_item = item
                break
        
        if tshirt_item:
            print(f"\nğŸ‘• Tã‚·ãƒ£ãƒ„ã‚¢ã‚¤ãƒ†ãƒ ç™ºè¦‹: {tshirt_item.get('name')} (ID: {tshirt_item.get('id')})")
        else:
            print("\nâš ï¸ Tã‚·ãƒ£ãƒ„ã‚¢ã‚¤ãƒ†ãƒ ãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã§ã—ãŸ")
        
        return True
        
    except Exception as e:
        print(f"âŒ ã‚¢ã‚¤ãƒ†ãƒ ä¸€è¦§å–å¾—ã‚¨ãƒ©ãƒ¼: {str(e)}")
        return False

if __name__ == "__main__":
    success = test_suzuri_api()
    
    if success:
        print("\nğŸ‰ SUZURI API ãƒ†ã‚¹ãƒˆæˆåŠŸï¼")
        print("âœ¨ AISHAã§SUZURIã‚°ãƒƒã‚ºä½œæˆæ©Ÿèƒ½ãŒåˆ©ç”¨å¯èƒ½ã§ã™")
    else:
        print("\nğŸ’¥ SUZURI API ãƒ†ã‚¹ãƒˆå¤±æ•—")
        print("ğŸ”§ è¨­å®šã‚„APIãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç¢ºèªã—ã¦ãã ã•ã„")
    
    print("=" * 50)
